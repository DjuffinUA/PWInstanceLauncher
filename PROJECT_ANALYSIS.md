# Бічний аналіз проєкту PWInstanceLauncher

## Що перевірено
- Структура проєкту, ресурси WPF, ViewModel/Services/Models.
- Узгодженість ресурсів у `*.csproj` з файлами на диску.
- Потенційне «сміття» (мертві посилання, зайві include-елементи, застарілий аналіз).

## Що прибрано без втрати функціональності
1. **Очищено `.csproj` від мертвих посилань** на неіснуючі файли класів (`dru.png`, `luk.png`, `mag.png`, `mist.png`, `sham.png`, `sik.png`, `sin.png`, `tank.png`, `var.png`).
2. **Узгоджено регістр імені ресурсу Priest**:
   - файл перейменовано у `Priest.png`;
   - у проєкті використовується той самий регістр (`imeges\\clas\\Priest.png`).
3. **Прибрано зайвий `<Folder Include="imeges\\icon\\" />`** з `.csproj` (не впливає на runtime-поведінку).
4. **Оновлено цей документ**: прибрані неактуальні твердження, додано короткі практичні рекомендації.

## Поточний технічний стан (коротко)
- Архітектура достатньо проста: `MainViewModel` + сервіси (`Config`, `Credential`, `Process`, `Desktop`, `Log`).
- Основний функціонал цілісний: CRUD профілів, запуск процесу з параметрами, моніторинг станів, перемикання desktop.
- Головні ризики — не в «поламаності», а в довготривалій підтримці.

## Рекомендації «чим простіше, тим надійніше»

### 1) Мінімізувати ручний список ресурсів
Зараз список картинок у `.csproj` і в коді (`AvailableClassImages`) підтримується вручну. Найпростіше стабільне рішення:
- або тримати **одне джерело правди** (наприклад, лише масив у коді + автоматичне включення ресурсів за маскою),
- або генерувати список у UI з папки ресурсів.

Це зменшить ризик помилок регістру/дублювання.

### 2) Розділити «великий» `MainViewModel` на 2 частини
Без рефакторингу «на півпроєкту»:
- залишити у `MainViewModel` лише UI-команди;
- моніторинг/запуск перенести в окремий `LauncherCoordinator`.

Так простіше тестувати й підтримувати.

### 3) Менше модальних повідомлень у нормальному сценарії
`MessageBox` для попереджень/успіху часто «шумить». Надійніше й простіше для UX:
- інформаційні події — у `StatusMessage` + лог;
- `MessageBox` залишити тільки для помилок і підтверджень видалення.

### 4) Зберігати налаштування режиму запуску одразу
`LaunchMode` змінюється через binding; варто зберігати його без очікування інших дій (наприклад, при зміні ComboBox або при закритті вікна). Це дрібно, але прибирає «несподівані втрати» налаштувань.

### 5) Документація: короткий `README`
Додати мінімальні секції:
- як запустити;
- де лежить `config.json`;
- які поля обов’язкові;
- обмеження (пароль у аргументах процесу гри).

Це дешево у підтримці та сильно знижує «побутові» помилки.

## Висновок
Проєкт уже досить робочий. Після локального прибирання «сміття» в ресурсах його стало легше супроводжувати. Подальші покращення варто робити точково, без ускладнення: менше ручної синхронізації, дрібне розділення відповідальностей, простіша поведінка UI.

## Додаткова перевірка логіки (оновлено)

### Виявлені дефекти та виправлення
1. **Налаштування LaunchMode не гарантувало збереження в `config.json` під час звичайної зміни у ComboBox.**
   - Проблема: двосторонній binding ішов напряму в `Config.LaunchMode`, але збереження виконувалось лише в інших сценаріях (`Save()` під час CRUD/зміни шляху).
   - Виправлення: додано VM-властивість `SelectedLaunchMode` із `Save()` та логуванням при зміні; binding переведено на неї.

2. **Пошук запущеного процесу за логіном мав ризик хибного збігу.**
   - Проблема: перевірка `commandLine.Contains("user:{login}")` могла матчити часткові значення (наприклад, `user:alex` у `user:alexander`).
   - Виправлення: додано `CommandLineContainsLogin(...)` із перевіркою меж токена (кінець рядка/пробіл/лапка).

3. **Конфіг міг містити невалідне enum-значення `LaunchMode`.**
   - Проблема: десеріалізація могла підхопити довільне числове значення enum із вручну зіпсованого `config.json`.
   - Виправлення: у `ValidateAndNormalize` додано нормалізацію через `Enum.IsDefined(...)` з fallback на `SeparateDesktop`.

### Що ще перевірено вручну по коду
- Стани профілів (`Running`/`Offline`) синхронізуються таймером і коректно скидаються при завершенні процесу.
- Обробка зміни логіна профілю має cleanup старих desktop-mapping.
- Валідація даних профілю в діалозі редагування не дозволяє створити пустий логін/ім'я.
- Сервіс конфігурації виконує нормалізацію строк та відновлення дефолтів при пошкодженому JSON.
